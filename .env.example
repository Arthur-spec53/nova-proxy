# Nova Proxy 环境变量配置示例
# 复制此文件为 .env 并根据实际环境修改配置

# ============================================================================
# 基础配置
# ============================================================================

# 构建版本信息
BUILD_VERSION=1.0.0
BUILD_COMMIT=unknown
BUILD_DATE=unknown

# 日志级别 (debug, info, warn, error)
LOG_LEVEL=info

# 运行模式 (development, staging, production)
ENVIRONMENT=development

# ============================================================================
# 域名配置 (生产环境)
# ============================================================================

# Nova Proxy 主域名
NOVA_DOMAIN=nova.example.com

# 监控服务域名
PROMETHEUS_DOMAIN=prometheus.example.com
GRAFANA_DOMAIN=grafana.example.com
JAEGER_DOMAIN=jaeger.example.com
ALERTMANAGER_DOMAIN=alerts.example.com

# 负载均衡器域名
NGINX_DOMAIN=lb.example.com

# ============================================================================
# 认证配置
# ============================================================================

# Grafana 管理员密码
GRAFANA_ADMIN_PASSWORD=your_secure_grafana_password_here

# Redis 密码
REDIS_PASSWORD=your_secure_redis_password_here

# Elasticsearch 认证
ELASTICSEARCH_USERNAME=elastic
ELASTICSEARCH_PASSWORD=your_secure_elasticsearch_password_here

# HTTP Basic Auth 用户 (格式: user:password_hash)
# 生成方法: echo $(htpasswd -nb user password) | sed -e s/\$/\$\$/g
BASIC_AUTH_USERS=admin:$$2y$$10$$example_hash_here

# ============================================================================
# Nova Proxy 应用配置
# ============================================================================

# 服务器配置
NOVA_SERVER_BIND_ADDR=0.0.0.0:8443
NOVA_SERVER_CERT_FILE=/app/certs/server.crt
NOVA_SERVER_KEY_FILE=/app/certs/server.key

# 客户端配置
NOVA_CLIENT_SERVER_ADDR=nova-server:8443
NOVA_CLIENT_BIND_ADDR=0.0.0.0:1080

# 健康检查端口
NOVA_HEALTH_PORT=8080

# Prometheus 指标端口
NOVA_METRICS_PORT=9090

# ============================================================================
# 流量塑形配置
# ============================================================================

# 流量塑形间隔 (毫秒)
NOVA_SHAPING_INTERVAL_MS=100

# 最小填充大小 (字节)
NOVA_SHAPING_MIN_PAD_SIZE=64

# 最大填充大小 (字节)
NOVA_SHAPING_MAX_PAD_SIZE=1024

# 启用流量塑形
NOVA_SHAPING_ENABLED=true

# ============================================================================
# 安全配置
# ============================================================================

# TLS 配置
NOVA_TLS_MIN_VERSION=1.3
NOVA_TLS_CIPHER_SUITES=TLS_AES_256_GCM_SHA384,TLS_CHACHA20_POLY1305_SHA256,TLS_AES_128_GCM_SHA256

# 证书轮换间隔 (小时)
NOVA_CERT_ROTATION_INTERVAL=24

# 启用 HSTS
NOVA_HSTS_ENABLED=true
NOVA_HSTS_MAX_AGE=31536000

# ============================================================================
# 性能配置
# ============================================================================

# Go 运行时配置
GOMAXPROCS=0  # 0 表示使用所有可用 CPU
GOGC=100      # GC 目标百分比
GOMEMLIMIT=0  # 内存限制 (0 表示无限制)

# 连接池配置
NOVA_MAX_CONNECTIONS=1000
NOVA_CONNECTION_TIMEOUT=30s
NOVA_IDLE_TIMEOUT=300s

# 缓冲区大小
NOVA_READ_BUFFER_SIZE=32768
NOVA_WRITE_BUFFER_SIZE=32768

# ============================================================================
# 监控配置
# ============================================================================

# 启用指标收集
NOVA_METRICS_ENABLED=true

# 启用分布式追踪
NOVA_TRACING_ENABLED=true

# Jaeger 配置
JAEGER_AGENT_HOST=jaeger
JAEGER_AGENT_PORT=6831
JAEGER_SAMPLER_TYPE=const
JAEGER_SAMPLER_PARAM=1

# ============================================================================
# 日志配置
# ============================================================================

# 日志格式 (json, text)
NOVA_LOG_FORMAT=json

# 日志输出 (stdout, file)
NOVA_LOG_OUTPUT=stdout

# 日志文件路径
NOVA_LOG_FILE=/app/logs/nova.log

# 日志轮转配置
NOVA_LOG_MAX_SIZE=100  # MB
NOVA_LOG_MAX_BACKUPS=10
NOVA_LOG_MAX_AGE=30    # 天

# 启用日志压缩
NOVA_LOG_COMPRESS=true

# ============================================================================
# 数据库配置 (如果使用)
# ============================================================================

# PostgreSQL 配置
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=nova
POSTGRES_USER=nova
POSTGRES_PASSWORD=your_secure_postgres_password_here
POSTGRES_SSLMODE=require

# 连接池配置
POSTGRES_MAX_OPEN_CONNS=25
POSTGRES_MAX_IDLE_CONNS=5
POSTGRES_CONN_MAX_LIFETIME=300s

# ============================================================================
# 缓存配置
# ============================================================================

# Redis 配置
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=your_secure_redis_password_here

# 连接池配置
REDIS_POOL_SIZE=10
REDIS_MIN_IDLE_CONNS=5
REDIS_POOL_TIMEOUT=30s
REDIS_IDLE_TIMEOUT=300s

# ============================================================================
# 消息队列配置 (如果使用)
# ============================================================================

# RabbitMQ 配置
RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_USER=nova
RABBITMQ_PASSWORD=your_secure_rabbitmq_password_here
RABBITMQ_VHOST=/nova

# ============================================================================
# 对象存储配置 (如果使用)
# ============================================================================

# MinIO/S3 配置
S3_ENDPOINT=minio:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=your_secure_minio_password_here
S3_BUCKET=nova-storage
S3_REGION=us-east-1
S3_USE_SSL=false

# ============================================================================
# 备份配置
# ============================================================================

# 备份存储类型 (local, s3, gcs)
BACKUP_STORAGE_TYPE=local

# 本地备份路径
BACKUP_LOCAL_PATH=/app/backups

# S3 备份配置
BACKUP_S3_BUCKET=nova-backups
BACKUP_S3_PREFIX=nova-proxy

# 备份保留策略
BACKUP_RETENTION_DAYS=30
BACKUP_RETENTION_COUNT=10

# 备份加密密钥
BACKUP_ENCRYPTION_KEY=your_backup_encryption_key_here

# ============================================================================
# 开发环境配置
# ============================================================================

# 启用开发模式
NOVA_DEV_MODE=false

# 启用热重载
NOVA_HOT_RELOAD=false

# 启用调试模式
NOVA_DEBUG=false

# 启用性能分析
NOVA_PPROF_ENABLED=false
NOVA_PPROF_PORT=6060

# ============================================================================
# 测试配置
# ============================================================================

# 测试数据库
TEST_POSTGRES_DB=nova_test
TEST_REDIS_DB=1

# 测试超时
TEST_TIMEOUT=300s

# 集成测试目标
TEST_TARGET_URL=https://httpbin.org

# 性能测试配置
LOAD_TEST_DURATION=60s
LOAD_TEST_VUS=100
LOAD_TEST_RPS=1000

# ============================================================================
# 容器注册表配置
# ============================================================================

# Docker 镜像注册表
REGISTRY=ghcr.io/your-org

# 镜像版本
VERSION=latest

# ============================================================================
# Kubernetes 配置
# ============================================================================

# 命名空间
KUBERNETES_NAMESPACE=nova-proxy

# 存储类
KUBERNETES_STORAGE_CLASS=fast-ssd

# 资源限制
KUBERNETES_CPU_LIMIT=2000m
KUBERNETES_MEMORY_LIMIT=2Gi
KUBERNETES_CPU_REQUEST=500m
KUBERNETES_MEMORY_REQUEST=512Mi

# ============================================================================
# 告警配置
# ============================================================================

# Slack 告警
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
SLACK_CHANNEL=#alerts

# 邮件告警
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USERNAME=alerts@example.com
SMTP_PASSWORD=your_smtp_password_here
SMTP_FROM=Nova Proxy Alerts <alerts@example.com>
SMTP_TO=admin@example.com

# PagerDuty 告警
PAGERDUTY_INTEGRATION_KEY=your_pagerduty_integration_key_here

# ============================================================================
# 其他配置
# ============================================================================

# 时区
TZ=UTC

# 语言环境
LANG=en_US.UTF-8
LC_ALL=en_US.UTF-8

# 启用 IPv6
NOVA_IPV6_ENABLED=true

# 启用 HTTP/3
NOVA_HTTP3_ENABLED=true

# 启用 WebSocket
NOVA_WEBSOCKET_ENABLED=true

# API 限流配置
NOVA_RATE_LIMIT_ENABLED=true
NOVA_RATE_LIMIT_RPS=100
NOVA_RATE_LIMIT_BURST=200

# CORS 配置
NOVA_CORS_ENABLED=true
NOVA_CORS_ORIGINS=*
NOVA_CORS_METHODS=GET,POST,PUT,DELETE,OPTIONS
NOVA_CORS_HEADERS=*