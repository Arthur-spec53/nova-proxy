{{/*
Nova Proxy Helm Chart å®‰è£…è¯´æ˜
*/}}
ğŸš€ Nova Proxy å·²æˆåŠŸéƒ¨ç½²ï¼

ğŸ“‹ éƒ¨ç½²ä¿¡æ¯:
  - Chart ç‰ˆæœ¬: {{ .Chart.Version }}
  - åº”ç”¨ç‰ˆæœ¬: {{ .Chart.AppVersion }}
  - å‘å¸ƒåç§°: {{ .Release.Name }}
  - å‘½åç©ºé—´: {{ .Release.Namespace }}
  - å‰¯æœ¬æ•°: {{ .Values.replicaCount }}

ğŸŒ è®¿é—®ä¿¡æ¯:
{{- if .Values.ingress.enabled }}
{{- range $host := .Values.ingress.hosts }}
  {{- range .paths }}
  * https://{{ $host.host }}{{ .path }}
  {{- end }}
{{- end }}
{{- else if contains "NodePort" .Values.service.type }}
  * è·å– NodePort:
    export NODE_PORT=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ include "nova-proxy.fullname" . }})
    export NODE_IP=$(kubectl get nodes --namespace {{ .Release.Namespace }} -o jsonpath="{.items[0].status.addresses[0].address}")
    echo https://$NODE_IP:$NODE_PORT
{{- else if contains "LoadBalancer" .Values.service.type }}
  * è·å– LoadBalancer IP:
    export SERVICE_IP=$(kubectl get svc --namespace {{ .Release.Namespace }} {{ include "nova-proxy.fullname" . }} --template "{{ "{{" }} range (index .status.loadBalancer.ingress 0) {{ "}}" }}{{ "{{" }}.{{ "}}" }}{{ "{{" }} end {{ "}}" }}")
    echo https://$SERVICE_IP:{{ .Values.service.ports.https }}
    
    æ³¨æ„: LoadBalancer å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´æ¥åˆ†é…å¤–éƒ¨ IP
{{- else if contains "ClusterIP" .Values.service.type }}
  * ç«¯å£è½¬å‘è®¿é—®:
    kubectl --namespace {{ .Release.Namespace }} port-forward svc/{{ include "nova-proxy.fullname" . }} {{ .Values.service.ports.https }}:{{ .Values.service.ports.https }}
    ç„¶åè®¿é—®: https://127.0.0.1:{{ .Values.service.ports.https }}
{{- end }}

ğŸ” ç›‘æ§å’Œè°ƒè¯•:
{{- if .Values.monitoring.enabled }}
  * Prometheus æŒ‡æ ‡:
    kubectl --namespace {{ .Release.Namespace }} port-forward svc/{{ include "nova-proxy.fullname" . }} {{ .Values.container.ports.metrics }}:{{ .Values.container.ports.metrics }}
    è®¿é—®: http://127.0.0.1:{{ .Values.container.ports.metrics }}/metrics
{{- end }}

  * å¥åº·æ£€æŸ¥:
    kubectl --namespace {{ .Release.Namespace }} port-forward svc/{{ include "nova-proxy.fullname" . }} {{ .Values.container.ports.health }}:{{ .Values.container.ports.health }}
    è®¿é—®: http://127.0.0.1:{{ .Values.container.ports.health }}/health

{{- if .Values.debugging.pprof.enabled }}
  * pprof è°ƒè¯•:
    kubectl --namespace {{ .Release.Namespace }} port-forward svc/{{ include "nova-proxy.fullname" . }} {{ .Values.container.ports.pprof }}:{{ .Values.container.ports.pprof }}
    è®¿é—®: http://127.0.0.1:{{ .Values.container.ports.pprof }}/debug/pprof/
{{- end }}

ğŸ“Š çŠ¶æ€æ£€æŸ¥:
  * æŸ¥çœ‹ Pod çŠ¶æ€:
    kubectl get pods --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/name={{ include "nova-proxy.name" . }},app.kubernetes.io/instance={{ .Release.Name }}"

  * æŸ¥çœ‹æœåŠ¡çŠ¶æ€:
    kubectl get svc --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/name={{ include "nova-proxy.name" . }},app.kubernetes.io/instance={{ .Release.Name }}"

  * æŸ¥çœ‹æ—¥å¿—:
    kubectl logs --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/name={{ include "nova-proxy.name" . }},app.kubernetes.io/instance={{ .Release.Name }}" -f

{{- if .Values.autoscaling.enabled }}
  * æŸ¥çœ‹ HPA çŠ¶æ€:
    kubectl get hpa --namespace {{ .Release.Namespace }} {{ include "nova-proxy.fullname" . }}
{{- end }}

{{- if .Values.persistence.enabled }}
  * æŸ¥çœ‹ PVC çŠ¶æ€:
    kubectl get pvc --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/name={{ include "nova-proxy.name" . }},app.kubernetes.io/instance={{ .Release.Name }}"
{{- end }}

ğŸ”§ é…ç½®ç®¡ç†:
  * æŸ¥çœ‹ ConfigMap:
    kubectl get configmap --namespace {{ .Release.Namespace }} {{ include "nova-proxy.configMapName" . }} -o yaml

  * æŸ¥çœ‹ Secret:
    kubectl get secret --namespace {{ .Release.Namespace }} {{ include "nova-proxy.secretName" . }}

  * æ›´æ–°é…ç½®åé‡å¯:
    kubectl rollout restart deployment/{{ include "nova-proxy.fullname" . }} --namespace {{ .Release.Namespace }}

ğŸš¨ æ•…éšœæ’é™¤:
  * å¦‚æœ Pod æ— æ³•å¯åŠ¨ï¼Œæ£€æŸ¥:
    kubectl describe pod --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/name={{ include "nova-proxy.name" . }}"

  * å¦‚æœæœåŠ¡æ— æ³•è®¿é—®ï¼Œæ£€æŸ¥:
    kubectl describe svc --namespace {{ .Release.Namespace }} {{ include "nova-proxy.fullname" . }}

{{- if .Values.ingress.enabled }}
  * å¦‚æœ Ingress æ— æ³•è®¿é—®ï¼Œæ£€æŸ¥:
    kubectl describe ingress --namespace {{ .Release.Namespace }} {{ include "nova-proxy.fullname" . }}
{{- end }}

  * æŸ¥çœ‹äº‹ä»¶:
    kubectl get events --namespace {{ .Release.Namespace }} --sort-by='.lastTimestamp'

ğŸ“š æ›´å¤šä¿¡æ¯:
  * é¡¹ç›®æ–‡æ¡£: https://github.com/your-org/nova-proxy
  * Helm Chart æºç : https://github.com/your-org/nova-proxy/tree/main/helm/nova-proxy
  * é—®é¢˜åé¦ˆ: https://github.com/your-org/nova-proxy/issues

{{- if .Values.global.environment }}
ğŸ·ï¸  ç¯å¢ƒ: {{ .Values.global.environment }}
{{- end }}

{{- if .Values.security.networkPolicy.enabled }}
ğŸ”’ ç½‘ç»œç­–ç•¥å·²å¯ç”¨ï¼Œè¯·ç¡®ä¿ç›¸å…³æœåŠ¡å¯ä»¥æ­£å¸¸é€šä¿¡
{{- end }}

{{- if and .Values.tls.enabled (not .Values.tls.autoGenerate) }}
ğŸ” è¯·ç¡®ä¿ TLS è¯ä¹¦å·²æ­£ç¡®é…ç½®
{{- end }}

{{- if .Values.redis.enabled }}
ğŸ’¾ Redis ç¼“å­˜å·²å¯ç”¨
{{- end }}

{{- if .Values.database.enabled }}
ğŸ—„ï¸  æ•°æ®åº“è¿æ¥å·²é…ç½®
{{- end }}

æ„Ÿè°¢ä½¿ç”¨ Nova Proxy! ğŸ‰